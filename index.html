<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PrimeVest (mobile)</title>
<style>
  /* Mobile-first simple style (kept minimal to avoid touching layout too much) */
  :root{--bg:#ffffff;--card:#f7f8fa;--text:#0b1220;--muted:#6b7280;--green:#059669;--gold:#d4af37}
  *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
  header{display:flex;align-items:center;justify-content:space-between;padding:14px;border-bottom:1px solid #edf2f7}
  .logo{display:flex;align-items:center;gap:10px}
  .badge{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#34d399,#059669);color:#fff;font-weight:800}
  .balance-box{padding:6px 10px;border-radius:12px;background:#f0fff6;border:1px solid #e6fffb;color:var(--green);font-weight:800}
  main{padding:14px}
  .card{background:var(--card);padding:12px;border-radius:12px;margin-bottom:12px;box-shadow:0 6px 18px rgba(12,20,24,0.03)}
  h2{margin:0 0 8px;font-size:18px}
  p.mute{color:var(--muted);font-size:13px;margin:6px 0}
  button.primary{background:var(--green);color:#fff;border:0;padding:10px 12px;border-radius:10px;font-weight:700}
  button.ghost{background:transparent;border:1px solid #e6edf0;padding:8px 10px;border-radius:10px}
  input{width:100%;padding:10px;border-radius:10px;border:1px solid #e6edf0;margin-top:8px}
  nav.bottom{position:fixed;left:8px;right:8px;bottom:10px;display:flex;gap:8px;background:transparent}
  nav button{flex:1;padding:10px;border-radius:12px;border:1px solid #e6edf0;background:#fff}
  .hidden{display:none}
  .err{color:#dc2626;font-weight:700}
  .small{font-size:13px;color:var(--muted)}
  @media(min-width:720px){body{max-width:420px;margin:0 auto}}
</style>
</head>
<body>

<header>
  <div class="logo"><div class="badge" id="logoBadge">PV</div><div class="brand">PrimeVest</div></div>
  <!-- balance box: hidden until login -->
  <div id="topBalanceBox" class="balance-box hidden">₦ <span id="topBalance">0.00</span></div>
</header>

<main id="main">

  <!-- AUTH CARD -->
  <div id="authCard" class="card">
    <h2>Welcome to PrimeVest</h2>
    <p class="mute">Secure. Simple. Smart investing — demo, local-only.</p>

    <div id="signedOutActions">
      <button class="primary" onclick="showSignup()">Sign up</button>
      <button class="ghost" onclick="showLogin()">Sign in</button>
    </div>

    <!-- SIGNUP -->
    <div id="signupForm" class="hidden" style="margin-top:12px">
      <input id="suUser" placeholder="Create username">
      <input id="suPhone" placeholder="Phone number">
      <input id="suPass" type="password" placeholder="Password">
      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="primary" onclick="doSignup()">Create account</button>
        <button class="ghost" onclick="hideAuthForms()">Cancel</button>
      </div>
      <div id="suMsg" class="small"></div>
    </div>

    <!-- LOGIN -->
    <div id="loginForm" class="hidden" style="margin-top:12px">
      <input id="liUser" placeholder="Username">
      <input id="liPass" type="password" placeholder="Password">
      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="primary" onclick="doLogin()">Sign in</button>
        <button class="ghost" onclick="hideAuthForms()">Cancel</button>
      </div>
      <div id="liMsg" class="small"></div>
    </div>
  </div>

  <!-- HOME (visible after login) -->
  <div id="homeCard" class="card hidden">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div class="small">Welcome back</div>
        <div id="userGreeting" style="font-weight:800">User</div>
      </div>
      <div style="text-align:right">
        <div class="small">Current balance</div>
        <div style="font-weight:900;font-size:18px">₦ <span id="balance">0.00</span></div>
      </div>
    </div>
  </div>

  <!-- BUY SHARES -->
  <div id="buyCard" class="card hidden">
    <h2>Buy Shares</h2>
    <div id="buyMsg" class="err hidden"></div>

    <div id="packages">
      <!-- packages will go here -->
    </div>
  </div>

  <!-- FUNDING (account info hidden until login) -->
  <div id="fundCard" class="card hidden">
    <h2>Fund your account</h2>
    <p class="small">Minimum ₦1,500. Transfer to the account below and click "I have made this transaction".</p>

    <div id="accountInfo" class="hidden" style="margin-top:8px">
      <div class="small">Account Name</div>
      <div style="font-weight:800">PrimeVest INC</div>
      <div class="small" style="margin-top:8px">Account Number</div>
      <div style="font-weight:800">8164473823</div>
      <div class="small" style="margin-top:8px">Bank</div>
      <div style="font-weight:800">OPay</div>
    </div>

    <div style="margin-top:12px">
      <label class="small">Amount (₦)</label>
      <input id="fundAmount" type="number" placeholder="e.g. 5000">
      <label class="small" style="margin-top:8px">Reference (optional)</label>
      <input id="fundRef" placeholder="Bank reference">
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="primary" onclick="createPending()">I have made this transaction</button>
        <button class="ghost" onclick="clearFundForm()">Clear</button>
      </div>
      <div id="fundMsg" class="small" style="margin-top:8px"></div>
    </div>
  </div>

  <!-- PROFILE -->
  <div id="profileCard" class="card hidden">
    <h2>Profile</h2>
    <div id="profileInfo"></div>
    <div style="margin-top:10px">
      <button class="ghost" onclick="doLogout()">Sign out</button>
    </div>
  </div>

</main>

<nav class="bottom" id="bottomNav" style="display:none">
  <button onclick="showTab('home')">Home</button>
  <button onclick="showTab('buy')">Buy Shares</button>
  <button onclick="showTab('fund')">Fund</button>
  <button onclick="showTab('profile')">Profile</button>
</nav>

<script>
/*
Local-only PrimeVest offline implementation.
Data stored in localStorage under key: primevest_local_db
Structure:
{
  users: { username: { username, phone, pass, balance, totalFunded, shares: [] } },
  transactions: [ { id, username, amount, reference, status:'pending'|'confirmed'|'rejected', createdAt } ]
}
*/

// -------- storage helpers --------
const STORAGE_KEY = 'primevest_local_db';
function loadDB(){ try{ const s = localStorage.getItem(STORAGE_KEY); return s?JSON.parse(s):{users:{},transactions:[]}; }catch(e){return {users:{},transactions:[]}; } }
function saveDB(db){ localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); }
let DB = loadDB();

// -------- UI helpers --------
function show(el){ document.getElementById(el+'Card') && (document.getElementById(el+'Card').classList.remove('hidden')); }
function hide(el){ document.getElementById(el+'Card') && (document.getElementById(el+'Card').classList.add('hidden')); }
function hideAllMain(){ ['home','buy','fund','profile'].forEach(id=>hide(id)); }
function showTab(tab){
  hideAllMain();
  if(tab==='home') show('home');
  if(tab==='buy') { renderPackages(); show('buy'); }
  if(tab==='fund') show('fund');
  if(tab==='profile') renderProfile();
}

// -------- auth UI --------
function showSignup(){ document.getElementById('signupForm').classList.remove('hidden'); document.getElementById('loginForm').classList.add('hidden'); }
function showLogin(){ document.getElementById('loginForm').classList.remove('hidden'); document.getElementById('signupForm').classList.add('hidden'); }
function hideAuthForms(){ document.getElementById('signupForm').classList.add('hidden'); document.getElementById('loginForm').classList.add('hidden'); }

// -------- user session --------
let currentUser = null;
function setSession(username){
  currentUser = username;
  localStorage.setItem('primevest_session', username);
}
function clearSession(){
  currentUser = null;
  localStorage.removeItem('primevest_session');
}

// -------- initial session restore --------
const savedSession = localStorage.getItem('primevest_session');
if(savedSession && DB.users[savedSession]) {
  setSession(savedSession);
  onLogin();
}

// -------- signup / login (local) --------
function doSignup(){
  const u = document.getElementById('suUser').value.trim();
  const ph = document.getElementById('suPhone').value.trim();
  const p = document.getElementById('suPass').value;
  if(!u || !ph || !p){ document.getElementById('suMsg').innerText='Fill all fields'; return; }
  if(DB.users[u]){ document.getElementById('suMsg').innerText='Username exists'; return; }
  DB.users[u] = { username:u, phone:ph, pass:p, balance:0, totalFunded:0, shares:[] };
  saveDB(DB);
  document.getElementById('suMsg').innerText = 'Account created. Please sign in.';
  document.getElementById('suUser').value=''; document.getElementById('suPhone').value=''; document.getElementById('suPass').value='';
  showLogin();
}

function doLogin(){
  const u = document.getElementById('liUser').value.trim();
  const p = document.getElementById('liPass').value;
  const user = DB.users[u];
  if(!u || !p){ document.getElementById('liMsg').innerText='Enter details'; return; }
  if(!user || user.pass !== p){ document.getElementById('liMsg').innerText='Invalid credentials'; return; }
  setSession(u);
  onLogin();
}

// -------- on login (show main UI) --------
function onLogin(){
  document.getElementById('authCard').classList.add('hidden');
  document.getElementById('bottomNav').style.display='flex';
  document.getElementById('topBalanceBox').classList.remove('hidden');
  updateBalanceUI();
  showTab('home');
  // show account info in fund only after login
  document.getElementById('accountInfo').classList.remove('hidden');
  // greet
  document.getElementById('userGreeting').innerText = currentUser;
}

// -------- logout --------
function doLogout(){
  clearSession();
  location.reload();
}

// -------- packages (unchanged semantics) --------
const PACKAGES = [
  {cost:2000,payout:10000,label:'Agriculture'},
  {cost:10000,payout:50000,label:'Resources'},
  {cost:100000,payout:1000000,label:'Real Estate'}
];

function renderPackages(){
  const container = document.getElementById('packages');
  container.innerHTML='';
  PACKAGES.forEach((p, i)=>{
    const div = document.createElement('div');
    div.className='card';
    div.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div style="font-size:14px;font-weight:800">Get ₦${p.payout.toLocaleString()}</div>
        <div class="small">Pay ₦${p.cost.toLocaleString()} • ${p.label}</div>
      </div>
      <div><button class="primary" onclick="attemptBuy(${i})">BUY</button></div>
    </div>`;
    container.appendChild(div);
  });
}

function attemptBuy(index){
  if(!currentUser){ alert('Please sign in to buy.'); return; }
  const p = PACKAGES[index];
  const user = DB.users[currentUser];
  if((user.balance || 0) < p.cost){
    document.getElementById('buyMsg').classList.remove('hidden');
    document.getElementById('buyMsg').innerText = 'Please fund your account to complete this action.';
    showTab('fund');
    return;
  }
  // deduct and record share
  user.balance = (user.balance||0) - p.cost;
  user.shares.push({package:p.label,cost:p.cost,payout:p.payout,createdAt:new Date().toISOString()});
  saveDB(DB);
  alert('Purchase successful');
  updateBalanceUI();
  renderProfileInfo();
}

// -------- funding (create pending tx) --------
function createPending(){
  if(!currentUser){ alert('Please sign in'); return; }
  const amt = Number(document.getElementById('fundAmount').value || 0);
  const ref = document.getElementById('fundRef').value.trim();
  if(!amt || amt < 1500){ document.getElementById('fundMsg').innerText = 'Minimum funding amount is ₦1,500.'; return; }
  const tx = { id: 'tx_'+Date.now(), username: currentUser, amount: Math.round(amt), reference: ref||null, status:'pending', createdAt: new Date().toISOString() };
  DB.transactions.push(tx);
  saveDB(DB);
  document.getElementById('fundMsg').innerText = 'Transaction recorded and is pending confirmation.';
  // clear form
  document.getElementById('fundAmount').value=''; document.getElementById('fundRef').value='';
  // keep pending until admin confirms locally
}

// -------- admin cannot view others remotely (offline) --------
// Admin page will read DB.transactions for pending items if opened on same browser/device.

// -------- update UI & profile rendering --------
function updateBalanceUI(){
  if(!currentUser) return;
  const user = DB.users[currentUser];
  document.getElementById('topBalance').innerText = (user.balance || 0).toFixed(2);
  document.getElementById('balance').innerText = (user.balance || 0).toFixed(2);
}

function renderProfileInfo(){
  if(!currentUser) return;
  const u = DB.users[currentUser];
  const container = document.getElementById('profileInfo');
  container.innerHTML = `
    <div class="small">Username: <strong>${u.username}</strong></div>
    <div class="small">Phone: <strong>${u.phone}</strong></div>
    <div class="small">Total funded: ₦${(u.totalFunded||0).toLocaleString()}</div>
    <div class="small">Shares bought: ${ (u.shares||[]).length }</div>
  `;
}

function renderProfile(){
  renderProfileInfo();
  showTab('profile'); // ensure profile visible
}

// -------- admin helper: used on admin.html to confirm txs (local) --------
function adminConfirmTransaction(txId){
  // this function will be called by admin page (admin.html) when admin confirms a tx on same device
  const txIndex = DB.transactions.findIndex(t=>t.id===txId);
  if(txIndex === -1) return false;
  const tx = DB.transactions[txIndex];
  if(tx.status !== 'pending') return false;
  // update user's balance
  const user = DB.users[tx.username];
  if(!user) return false;
  user.balance = (user.balance || 0) + tx.amount;
  user.totalFunded = (user.totalFunded || 0) + tx.amount;
  user.fundCount = (user.fundCount||0) + 1;
  // mark tx confirmed
  DB.transactions[txIndex].status = 'confirmed';
  DB.transactions[txIndex].confirmedAt = new Date().toISOString();
  saveDB(DB);
  // if admin is confirming on same device and session user matches, update UI
  if(currentUser === tx.username) updateBalanceUI();
  return true;
}

// expose adminConfirmTransaction to window so admin.html can call it (when admin uses same browser)
window.adminConfirmTransaction = adminConfirmTransaction;

// -------- utility: clear fund form --------
function clearFundForm(){ document.getElementById('fundAmount').value=''; document.getElementById('fundRef').value=''; document.getElementById('fundMsg').innerText=''; }

// -------- render initial UI depending on login --------
if(currentUser){
  onLogin();
} else {
  // show auth card
  document.getElementById('authCard').classList.remove('hidden');
}
</script>
</body>
</html>
