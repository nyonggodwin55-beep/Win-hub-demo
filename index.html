<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PrimeVest INC — Mobile</title>
<style>
  :root{--bg:#ffffff;--card:#f7f8fa;--text:#0b1220;--muted:#6b7280;--green:#059669;--gold:#d4af37}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
  header{display:flex;align-items:center;justify-content:space-between;padding:14px;border-bottom:1px solid #edf2f7}
  .logo{display:flex;align-items:center;gap:10px}
  .badge{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#34d399,#059669);color:#fff;font-weight:800}
  .balance-box{padding:6px 10px;border-radius:12px;background:#f0fff6;border:1px solid #e6fffb;color:var(--green);font-weight:800}
  main{padding:14px;padding-bottom:160px}
  .card{background:var(--card);padding:12px;border-radius:12px;margin-bottom:12px;box-shadow:0 6px 18px rgba(12,20,24,0.03)}
  h2{margin:0 0 8px;font-size:18px}
  p.mute{color:var(--muted);font-size:13px;margin:6px 0}
  button.primary{background:var(--green);color:#fff;border:0;padding:10px 12px;border-radius:10px;font-weight:700}
  button.ghost{background:transparent;border:1px solid #e6edf0;padding:8px 10px;border-radius:10px}
  input{width:100%;padding:10px;border-radius:10px;border:1px solid #e6edf0;margin-top:8px}
  nav.bottom{position:fixed;left:8px;right:8px;bottom:10px;display:flex;gap:8px;background:transparent}
  nav button{flex:1;padding:10px;border-radius:12px;border:1px solid #e6edf0;background:#fff}
  .hidden{display:none}
  .err{color:#dc2626;font-weight:700}
  .small{font-size:13px;color:var(--muted)}
  /* shares */
  .shares-grid{display:grid;grid-template-columns:1fr;gap:12px}
  .share-card{display:flex;gap:10px;align-items:center;padding:12px;border-radius:12px;background:#fff;border:1px solid #eef3f2}
  .share-art{width:86px;height:86px;border-radius:10px;background:#eee;flex-shrink:0;overflow:hidden}
  .share-art img{width:100%;height:100%;object-fit:cover;display:block}
  .share-info{flex:1}
  .share-title{font-weight:800}
  .share-meta{color:var(--muted);font-size:13px;margin-top:6px}
  .share-action{margin-left:8px}
  /* banner */
  .banner{display:flex;gap:12px;align-items:center}
  .banner img{width:110px;height:80px;border-radius:10px;object-fit:cover}
  .join-cta{background:linear-gradient(90deg,#e6fff1,#dffbf4);padding:10px;border-radius:10px;text-align:center}
  /* tx history */
  .tx-list{padding-left:14px;margin-top:8px}
  .tx-item{margin-bottom:6px;font-size:13px}
  .shares-table{width:100%;border-collapse:collapse;margin-top:8px}
  .shares-table th, .shares-table td{padding:8px;border-bottom:1px solid #eee;text-align:left;font-size:13px}
  .withdraw-card input{margin-bottom:8px}
  @media(min-width:720px){body{max-width:420px;margin:0 auto}}
</style>
</head>
<body>

<header>
  <div class="logo"><div class="badge" id="logoBadge">PV</div><div class="brand">PrimeVest</div></div>
  <div id="topBalanceBox" class="balance-box hidden">₦ <span id="topBalance">0.00</span></div>
</header>

<main id="main">

  <!-- AUTH CARD -->
  <div id="authCard" class="card">
    <h2>Welcome to PrimeVest</h2>
    <p class="mute">Secure. Simple. Smart investing — demo local-only.</p>

    <div id="signedOutActions">
      <button class="primary" onclick="showSignup()">Sign up</button>
      <button class="ghost" onclick="showLogin()">Sign in</button>
    </div>l

   <!-- SIGNUP -->
<div id="signupForm" class="hidden" style="margin-top:12px">
  <input id="suUser" placeholder="Create username">
  <input id="suPass" type="password" placeholder="Password">
  <button id="signupBtn">Sign Up</button>
  <p>Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
</div>

<script>
function showSignup() {
  document.getElementById('loginForm').classList.add('hidden');
  document.getElementById('signupForm').classList.remove('hidden');
}

function showLogin() {
  document.getElementById('signupForm').classList.add('hidden');
  document.getElementById('loginForm').classList.remove('hidden');
}

document.getElementById('signupBtn').addEventListener('click', function() {
  const username = document.getElementById('suUser').value.trim();
  const password = document.getElementById('suPass').value.trim();

  if (!username || !password) {
    alert("Please fill in both username and password");
    return;
  }

  // Save locally
  localStorage.setItem("user_" + username, password);
  alert("Account created successfully! You can now log in.");
  showLogin();
});
</script>

    <!-- LOGIN -->
    <div id="loginForm" class="hidden" style="margin-top:12px">
      <input id="liUser" placeholder="Username">
      <input id="liPass" type="password" placeholder="Password">
      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="primary" onclick="doLogin()">Sign in</button>
        <button class="ghost" onclick="hideAuthForms()">Can
      </div>
      <div id="liMsg" class="small"></div>
    </div>
  </div>

  <!-- HOME -->
  <div id="homeCard" class="card hidden">
    <div class="banner">
      <img src="https://i.imgur.com/8kmJzZK.png" alt="people holding banner">
      <div>
        <h2>PrimeVest INC</h2>
        <p class="small">We bring curated investment products for everyday investors. Join our community and invest in real projects.</p>
        <div style="margin-top:8px" class="join-cta">Join our community — trusted investors and verified opportunities</div>
      </div>
    </div>

    <div style="margin-top:12px">
      <div class="small">Top shares this week</div>
      <div class="card" style="margin-top:8px;padding:10px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:900">₦10,000 → ₦1,000,000</div>
            <div class="small">Featured — Solar Energy Initiative</div>
          </div>
          <div style="font-weight:800;color:var(--green)">Hot</div>
        </div>
      </div>
    </div>
  </div>

  <!-- BUY SHARES -->
  <div id="buyCard" class="card hidden">
    <h2>Buy Shares</h2>
    <div id="buyMsg" class="err hidden"></div>
    <div class="shares-grid" id="sharesGrid" style="margin-top:12px"></div>
  </div>

  <!-- FUNDING -->
  <div id="fundCard" class="card hidden">
    <h2>Fund your account</h2>
    <p class="small">Minimum ₦1,500. Transfer to the account below then confirm your payment.</p>

    <div id="accountInfo" class="hidden" style="margin-top:8px">
      <div class="small">Account Name</div>
      <div style="font-weight:800">PrimeVest INC</div>
      <div class="small" style="margin-top:8px">Account Number</div>
      <div style="font-weight:800">8164473823</div>
      <div class="small" style="margin-top:8px">Bank</div>
      <div style="font-weight:800">OPay</div>
    </div>

    <div style="margin-top:12px">
      <label class="small">Amount (₦)</label>
      <input id="fundAmount" type="number" placeholder="e.g. 5000">
      <label class="small" style="margin-top:8px">Reference (optional)</label>
      <input id="fundRef" placeholder="Bank reference">
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="primary" onclick="createPending()">I have made this transaction</button>
        <button class="ghost" onclick="clearFundForm()">Clear</button>
      </div>
      <div id="fundMsg" class="small" style="margin-top:8px"></div>
      <div id="userPending" class="small" style="margin-top:8px"></div>
    </div>
  </div>

  <!-- PROFILE -->
  <div id="profileCard" class="card hidden">
    <h2>Profile</h2>
    <div id="profileInfo"></div>

    <div style="margin-top:10px">
      <div class="small">Shares Bought</div>
      <table class="shares-table" id="sharesTable">
        <thead>
          <tr><th>Share</th><th>Amount</th><th>Duration</th><th>Days left</th><th>Status</th></tr>
        </thead>
        <tbody id="sharesTbody"></tbody>
      </table>
    </div>

    <div style="margin-top:12px" class="card withdraw-card">
      <h3>Withdraw</h3>
      <p class="small">Withdraw (demo). Enter account details and amount.</p>
      <input id="wdName" placeholder="Account name">
      <input id="wdBank" placeholder="Bank name">
      <input id="wdAccount" placeholder="Account number">
      <input id="wdAmount" type="number" placeholder="Amount to withdraw (₦)">
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="primary" onclick="requestWithdrawal()">Withdraw</button>
      </div>
      <div id="wdMsg" class="small" style="margin-top:8px"></div>
    </div>

    <div style="margin-top:12px">
      <div class="small">Transaction history</div>
      <div id="txHistory" class="tx-list"></div>
    </div>

    <div style="margin-top:10px">
      <button class="ghost" onclick="doLogout()">Sign out</button>
    </div>
  </div>

</main>

<nav class="bottom" id="bottomNav" style="display:none">
  <button onclick="showTab('home')">Home</button>
  <button onclick="showTab('buy')">Buy Shares</button>
  <button onclick="showTab('fund')">Fund</button>
  <button onclick="showTab('profile')">Profile</button>
</nav>

<script>
/* Local DB structure (single key)
  primevest_local_db = {
    users: { username: { username, pass, balance, totalFunded, shares:[], withdrawals:[] } },
    transactions: [ { id, type:'fund'|'withdraw', username, amount, reference, bankInfo?, status:'pending'|'confirmed'|'rejected', createdAt, ... } ]
  }
*/
const STORAGE_KEY = 'primevest_local_db';
function loadDB(){ try{ const s = localStorage.getItem(STORAGE_KEY); return s?JSON.parse(s):{users:{},transactions:[]}; }catch(e){return {users:{},transactions:[]}; } }
function saveDB(db){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
  // keep legacy keys for older admin compatibility
  localStorage.setItem('pendingTransactions', JSON.stringify(db.transactions.filter(t=>t.status==='pending' && t.type==='fund')));
  localStorage.setItem('users', JSON.stringify(db.users));
}
let DB = loadDB();

/* UI helpers */
function show(el){ document.getElementById(el+'Card') && (document.getElementById(el+'Card').classList.remove('hidden')); }
function hide(el){ document.getElementById(el+'Card') && (document.getElementById(el+'Card').classList.add('hidden')); }
function hideAllMain(){ ['home','buy','fund','profile'].forEach(id=>hide(id)); }
function showTab(tab){
  hideAllMain();
  if(tab==='home') show('home');
  if(tab==='buy'){ renderShares(); show('buy'); }
  if(tab==='fund') show('fund');
  if(tab==='profile') { renderProfile(); show('profile'); }
}

/* Auth forms */
function showSignup(){ document.getElementById('signupForm').classList.remove('hidden'); document.getElementById('loginForm').classList.add('hidden'); }
function showLogin(){ document.getElementById('loginForm').classList.remove('hidden'); document.getElementById('signupForm').classList.add('hidden'); }
function hideAuthForms(){ document.getElementById('signupForm').classList.add('hidden'); document.getElementById('loginForm').classList.add('hidden'); }

/* Session */
let currentUser = null;
function setSession(username){ currentUser = username; localStorage.setItem('primevest_session', username); }
function clearSession(){ currentUser = null; localStorage.removeItem('primevest_session'); }

/* restore session */
const savedSession = localStorage.getItem('primevest_session');
if(savedSession && DB.users[savedSession]) { setSession(savedSession); onLogin(); }

/* Signup/Login */
function doSignup(){
  const u = document.getElementById('suUser').value.trim();
  const p = document.getElementById('suPass').value;
  if(!u||!p){ document.getElementById('suMsg').innerText='Fill all fields'; return; }
  if(DB.users[u]){ document.getElementById('suMsg').innerText='Username exists'; return; }
  DB.users[u] = { username:u, pass:p, balance:0, totalFunded:0, shares:[], withdrawals:[] };
  saveDB(DB);
  document.getElementById('suMsg').innerText='Account created. Please sign in.';
  document.getElementById('suUser').value=''; document.getElementById('suPass').value='';
  showLogin();
}
function doLogin(){
  const u = document.getElementById('liUser').value.trim();
  const p = document.getElementById('liPass').value;
  const user = DB.users[u];
  if(!u||!p){ document.getElementById('liMsg').innerText='Enter details'; return; }
  if(!user||user.pass!==p){ document.getElementById('liMsg').innerText='Invalid credentials'; return; }
  setSession(u);
  onLogin();
}

/* onLogin */
function onLogin(){
  document.getElementById('authCard').classList.add('hidden');
  document.getElementById('bottomNav').style.display='flex';
  document.getElementById('topBalanceBox').classList.remove('hidden');
  document.getElementById('accountInfo').classList.remove('hidden');
  updateBalanceUI();
  showTab('home');
  renderProfile();
  renderPendingForUser();
}

/* logout */
function doLogout(){ clearSession(); location.reload(); }

/* Shares list */
const SHARES = [
  {label:'Agriculture', cost:10000, payout:50000, days:26, img:'https://images.unsplash.com/photo-1501004318641-b39e6451bec6?auto=format&fit=crop&w=600&q=60'},
  {label:'Solar Energy', cost:20000, payout:120000, days:45, img:'https://images.unsplash.com/photo-1509395062183-67c5ad6faff9?auto=format&fit=crop&w=600&q=60'},
  {label:'Water Resources', cost:5000, payout:20000, days:18, img:'https://images.unsplash.com/photo-1504198453319-5ce911bafcde?auto=format&fit=crop&w=600&q=60'},
  {label:'Real Estate', cost:25000, payout:150000, days:120, img:'https://images.unsplash.com/photo-1568605114967-8130f3a36994?auto=format&fit=crop&w=600&q=60'},
  {label:'Technology', cost:15000, payout:80000, days:60, img:'https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&w=600&q=60'},
  {label:'Healthcare', cost:8000, payout:35000, days:40, img:'https://images.unsplash.com/photo-1588776814546-76bc5d1f2e8f?auto=format&fit=crop&w=600&q=60'},
  {label:'Education', cost:7000, payout:30000, days:30, img:'https://images.unsplash.com/photo-1509062522246-3755977927d7?auto=format&fit=crop&w=600&q=60'},
  {label:'Transport', cost:12000, payout:60000, days:50, img:'https://images.unsplash.com/photo-1502877338535-766e1452684a?auto=format&fit=crop&w=600&q=60'},
  {label:'Manufacturing', cost:30000, payout:250000, days:90, img:'https://images.unsplash.com/photo-1543168258-4b5f30e5b8b0?auto=format&fit=crop&w=600&q=60'},
  {label:'Fintech', cost:9000, payout:45000, days:28, img:'https://images.unsplash.com/photo-1559526324-593bc073d938?auto=format&fit=crop&w=600&q=60'},
  {label:'Logistics', cost:6000, payout:28000, days:22, img:'https://images.unsplash.com/photo-1517148815978-75f6acaaff06?auto=format&fit=crop&w=600&q=60'},
  {label:'Tourism', cost:4000, payout:15000, days:20, img:'https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=600&q=60'},
  {label:'Agri-Tech', cost:11000, payout:55000, days:35, img:'https://images.unsplash.com/photo-1501004318641-b39e6451bec6?auto=format&fit=crop&w=600&q=60'},
  {label:'Energy Storage', cost:22000, payout:130000, days:75, img:'https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&w=600&q=60'},
  {label:'Enterprise', cost:100000, payout:1000000, days:365, img:'https://images.unsplash.com/photo-1492562080023-ab3db95bfbce?auto=format&fit=crop&w=600&q=60'}
];

function renderShares(){
  const container = document.getElementById('sharesGrid');
  container.innerHTML = '';
  SHARES.forEach((s, idx)=>{
    const div = document.createElement('div');
    div.className = 'share-card';
    div.innerHTML = `
      <div class="share-art"><img src="${s.img}" alt="${s.label}"></div>
      <div class="share-info">
        <div class="share-title">${s.label}</div>
        <div style="margin-top:6px;font-weight:800">₦${s.cost.toLocaleString()} → ₦${s.payout.toLocaleString()}</div>
        <div class="share-meta">Duration: ${s.days} days</div>
      </div>
      <div class="share-action">
        <button class="primary" onclick="attemptBuy(${idx})">BUY</button>
      </div>
    `;
    container.appendChild(div);
  });
}

/* BUY */
function attemptBuy(index){
  if(!currentUser){ alert('Please sign in to buy.'); return; }
  const pack = SHARES[index];
  const user = DB.users[currentUser];
  if((user.balance || 0) < pack.cost){
    document.getElementById('buyMsg').classList.remove('hidden');
    document.getElementById('buyMsg').innerText = 'Please fund your account to complete this action.';
    showTab('fund');
    return;
  }
  // deduct immediately and save share with start date
  user.balance = (user.balance||0) - pack.cost;
  user.shares = user.shares || [];
  user.shares.push({
    package: pack.label,
    cost: pack.cost,
    payout: pack.payout,
    durationDays: pack.days,
    startDate: new Date().toISOString()
  });
  DB.users[currentUser] = user;
  saveDB(DB);
  alert('Purchase successful. Your share is active.');
  updateBalanceUI();
  renderProfile();
}

/* FUND: create pending funding transaction */
function createPending(){
  if(!currentUser){ alert('Please sign in'); return; }
  const amt = Number(document.getElementById('fundAmount').value || 0);
  const ref = document.getElementById('fundRef').value.trim();
  if(!amt || amt < 1500){ document.getElementById('fundMsg').innerText = 'Minimum funding amount is ₦1,500.'; return; }
  const tx = { id: 'tx_'+Date.now(), type:'fund', username: currentUser, amount: Math.round(amt), reference: ref||null, status:'pending', createdAt: new Date().toISOString() };
  DB.transactions.push(tx);
  saveDB(DB);
  document.getElementById('fundMsg').innerText = 'Transaction recorded and is pending confirmation.';
  document.getElementById('fundAmount').value=''; document.getElementById('fundRef').value='';
  renderPendingForUser();
}

/* Show user's latest pending tx */
function renderPendingForUser(){
  if(!currentUser) return;
  const tx = DB.transactions.filter(t=>t.username===currentUser && t.type==='fund').reverse()[0];
  if(tx && tx.status==='pending'){
    document.getElementById('userPending').innerText = `Pending Confirmation — tx id: ${tx.id}`;
  } else {
    document.getElementById('userPending').innerText = '';
  }
}

/* Withdrawal request (creates a withdrawal transaction)
   - Validate amount <= balance
   - Deduct amount immediately (lock funds)
   - Create transaction of type 'withdraw' with status 'pending'
*/
function requestWithdrawal(){
  if(!currentUser){ alert('Please sign in'); return; }
  const acctName = document.getElementById('wdName').value.trim();
  const bank = document.getElementById('wdBank').value.trim();
  const acctNo = document.getElementById('wdAccount').value.trim();
  const amt = Number(document.getElementById('wdAmount').value || 0);
  if(!acctName || !bank || !acctNo || !amt){ document.getElementById('wdMsg').innerText='Fill all fields'; return; }
  const user = DB.users[currentUser];
  if((user.balance||0) < amt){ document.getElementById('wdMsg').innerText='Insufficient balance'; return; }
  // deduct immediately (funds locked). If admin rejects, we will refund.
  user.balance = (user.balance||0) - amt;
  DB.users[currentUser] = user;
  const tx = { id:'wd_'+Date.now(), type:'withdraw', username:currentUser, amount:Math.round(amt), accountName:acctName, bank:bank, accountNumber:acctNo, status:'pending', createdAt:new Date().toISOString() };
  DB.transactions.push(tx);
  saveDB(DB);
  document.getElementById('wdMsg').innerText = 'Withdrawal requested — pending admin confirmation.';
  // clear inputs
  document.getElementById('wdName').value=''; document.getElementById('wdBank').value=''; document.getElementById('wdAccount').value=''; document.getElementById('wdAmount').value='';
  updateBalanceUI();
  renderProfile();
}

/* adminConfirmTransaction will be used by admin.html if admin confirms a fund or by id */
function adminConfirmTransaction(txId){
  const idx = DB.transactions.findIndex(t=>t.id===txId);
  if(idx === -1) return false;
  const tx = DB.transactions[idx];
  if(tx.status !== 'pending') return false;
  if(tx.type === 'fund'){
    // credit user's balance
    const user = DB.users[tx.username];
    if(!user) return false;
    user.balance = (user.balance||0) + tx.amount;
    user.totalFunded = (user.totalFunded||0) + tx.amount;
    DB.users[tx.username] = user;
    DB.transactions[idx].status = 'confirmed';
    DB.transactions[idx].confirmedAt = new Date().toISOString();
    saveDB(DB);
    // update U
